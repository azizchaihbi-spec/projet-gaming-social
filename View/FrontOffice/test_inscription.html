<!DOCTYPE html>
<html>
<head>
    <title>Test Inscription</title>
</head>
<body>
    <h1>Test d'inscription direct</h1>
    
    <form id="testForm">
        <input type="text" id="firstName" placeholder="Prénom" value="Test">
        <input type="text" id="lastName" placeholder="Nom" value="User">
        <input type="text" id="username" placeholder="Username" value="testuser">
        <input type="email" id="email" placeholder="Email" value="test@test.com">
        <input type="date" id="birthdate" value="2000-01-01">
        <select id="gender">
            <option value="male">Homme</option>
        </select>
        <select id="country">
            <option value="FR">France</option>
        </select>
        <select id="role">
            <option value="viewer">Viewer</option>
        </select>
        <input type="password" id="password" value="test123">
        <input type="password" id="confirmPassword" value="test123">
        <button type="button" onclick="testInscription()">Tester l'inscription</button>
    </form>
    
    <div id="result"></div>

    <script>
    async function testInscription() {
        const userData = {
            firstName: document.getElementById('firstName').value,
            lastName: document.getElementById('lastName').value,
            username: document.getElementById('username').value,
            email: document.getElementById('email').value,
            birthdate: document.getElementById('birthdate').value,
            gender: document.getElementById('gender').value,
            country: document.getElementById('country').value,
            city: "",
            role: document.getElementById('role').value,
            streamLink: "",
            streamDescription: "",
            streamPlatform: "",
            password: document.getElementById('password').value
        };

        console.log('Données envoyées:', userData);

        try {
            const response = await fetch('../../Controller/authController.php?action=register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(userData)
            });

            console.log('Status:', response.status);
            console.log('Headers:', response.headers);
            
            const result = await response.text();
            console.log('Réponse brute:', result);
            
            let jsonResult;
            try {
                jsonResult = JSON.parse(result);
            } catch (e) {
                document.getElementById('result').innerHTML = 
                    '❌ Réponse non JSON: ' + result;
                return;
            }

            document.getElementById('result').innerHTML = 
                jsonResult.success ? 
                '✅ Succès: ' + jsonResult.message : 
                '❌ Erreur: ' + jsonResult.message;

        } catch (error) {
            document.getElementById('result').innerHTML = 
                '❌ Erreur fetch: ' + error.message;
            console.error('Erreur:', error);
        }
    }
    </script>
</body>
</html>