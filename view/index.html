<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Q/A</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>Q/A</h1>
      <p>Pose une question, partage une idée, réponds aux autres.</p>
    </div>

    <!-- Formulaire pour poster une question -->
    <div class="ask-section">
      <h2>Poser une question</h2>
      <form id="postForm">
        <input type="text" id="postAuthor" placeholder="Ton nom (ou pseudo)" required />
        <input type="text" id="postTitle" placeholder="Titre de ta question" required />
        <textarea id="postContent" rows="4" placeholder="Décris ton idée ou ta question..." required></textarea>
        <button type="submit">Publier</button>
      </form>
    </div>

    <!-- Liste des questions -->
    <div id="postsContainer"></div>
  </div>

  <script>
    // Données en mémoire (simule une base de données)
    let posts = JSON.parse(localStorage.getItem('neoRedditPosts')) || [];

    // Sauvegarde dans localStorage
    function savePosts() {
      localStorage.setItem('neoRedditPosts', JSON.stringify(posts));
    }

    // Format date
    function formatDate(date) {
      return new Intl.DateTimeFormat('fr-FR', {
        day: 'numeric',
        month: 'short',
        hour: '2-digit',
        minute: '2-digit'
      }).format(date);
    }

    // Afficher tous les posts
    function renderPosts() {
      const container = document.getElementById('postsContainer');
      container.innerHTML = '';

      if (posts.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:#888;">Aucun post pour le moment. Sois le premier !</p>';
        return;
      }

      posts.forEach((post, postIndex) => {
        const postEl = document.createElement('div');
        postEl.className = 'question-card';
        postEl.innerHTML = `
          <div class="question-title">${post.title}</div>
          <div class="question-author">par ${post.author} • ${formatDate(new Date(post.date))}</div>
          <div class="question-content">${post.content.replace(/\n/g, '<br>')}</div>
          
          <button class="reply-btn" onclick="toggleReplyForm(${postIndex})">Répondre</button>
          
          <div class="reply-form" id="replyForm-${postIndex}">
            <form onsubmit="submitReply(event, ${postIndex})">
              <input type="text" placeholder="Ton nom" required />
              <textarea rows="3" placeholder="Ta réponse..." required></textarea>
              <button type="submit">Envoyer</button>
              <button type="button" onclick="toggleReplyForm(${postIndex})" style="background:#ff1493; margin-left:8px;">Annuler</button>
            </form>
          </div>

          <div class="answers" id="answers-${postIndex}">
            ${post.answers.map((ans, i) => `
              <div class="answer">
                <div class="answer-author">${ans.author}</div>
                <div class="answer-date">${formatDate(new Date(ans.date))}</div>
                <div class="answer-content">${ans.content.replace(/\n/g, '<br>')}</div>
              </div>
            `).join('')}
          </div>
        `;
        container.appendChild(postEl);
      });
    }

    // Afficher/masquer le formulaire de réponse
    window.toggleReplyForm = function(postIndex) {
      const form = document.getElementById(`replyForm-${postIndex}`);
      form.style.display = form.style.display === 'block' ? 'none' : 'block';
    };

    // Soumettre une réponse
    window.submitReply = function(e, postIndex) {
      e.preventDefault();
      const form = e.target;
      const author = form.querySelector('input').value.trim();
      const content = form.querySelector('textarea').value.trim();

      if (!author || !content) return;

      posts[postIndex].answers.push({
        author,
        content,
        date: new Date().toISOString()
      });

      savePosts();
      renderPosts();
    };

    // Soumettre un nouveau post
    document.getElementById('postForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const author = document.getElementById('postAuthor').value.trim();
      const title = document.getElementById('postTitle').value.trim();
      const content = document.getElementById('postContent').value.trim();

      if (!author || !title || !content) return;

      posts.unshift({
        title,
        author,
        content,
        date: new Date().toISOString(),
        answers: []
      });

      // Réinitialiser le formulaire
      this.reset();

      savePosts();
      renderPosts();
    });

    // Initialiser
    renderPosts();
  </script>
</body>
</html>